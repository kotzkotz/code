#apache 2.2
#yum -y install zlib
wget http://mirrors.tuna.tsinghua.edu.cn/apache/httpd/httpd-2.2.31.tar.bz2
tar -jxvf httpd-2.2.31.tar.bz2
cd httpd-2.2.31
./configure --prefix=/usr/local/http2  \
--enable-modules=all \
--enable-rewrite \
--enable-mods-shared=all \
--enable-so \
--with-apr=/usr/local/apr \
--with-apr-util=/usr/local/web/apr-util

#apache 2.4
#error: APR not found. Please read the documentation
#http://www.cnblogs.com/Anker/p/3355573.html
wget http://mirrors.tuna.tsinghua.edu.cn/apache/httpd/httpd-2.4.20.tar.bz2
./configure --prefix=/usr/local/http2  \
--enable-modules=all \
--enable-rewrite \
--enable-mods-shared=all \
--enable-so \
--with-apr=/usr/local/apr \
--with-apr-util=/usr/local/apr-util \
--with-pcre=/usr/local/pcre 

make && make install
#拷贝apache配置文件
cp /usr/local/http2/conf/httpd.conf /usr/local/http2/conf/httpd.conf.bak
#启动apache
/usr/local/http2/bin/apachectl start

#使用service httpd start 
#复制一下启动文件
cp /usr/local/http2/bin/apachectl /etc/rc.d/init.d/httpd
#增加执行权限
chmod +x /etc/init.d/httpd
#apache加入开机启动
打开 vi /etc/rc.d/init.d/httpd 添加(#!/bin/sh下面)
#chkconfig: 2345 10 90
#description: Activates/Deactivates Apache Web Server
ps:#必须有,2345是设为要启动的运行级别，10是启动优先级，90是杀死进程的优先级，谁优先谁先挂的意思。

#增加系统服务
chkconfig --add httpd 
#设置运行级别
chkconfig httpd on
#重启apache
service httpd restart

#mysql 5.5
#查看是否有旧的mysql
rpm -qa | grep mysql
#删除旧的mysql
rpm -e mysql-libs-5.1.73-7.el6.i686
rpm -e --nodeps mysql-libs-5.1.73-7.el6.i686
#下载mysql 5.5
wget http://cdn.mysql.com/Downloads/MySQL-5.5/mysql-5.5.50-linux2.6-i686.tar.gz
wget http://mirrors.sohu.com/mysql/MySQL-5.5/mysql-5.5.50.tar.gz

tar -xzvf mysql-5.5.50-linux2.6-i686.tar.gz
#mysql 5.5
#安装cmake
#yum -y install cmake
cmake -DMYSQL_USER=mysql \
-DCMAKE_INSTALL_PREFIX=/usr/local/mysql \
-DINSTALL_DATADIR=/usr/local/mysql/data \
-DMYSQL_UNIX_ADDR=/tmp/mysqld.sock \
-DDEFAULT_CHARSET=utf8  \
-DDEFAULT_COLLATION=utf8_general_ci \
-DEXTRA_CHARSETS=all \
-DWITH_EMBEDDED_SERVER=1 \
-DENABLED_LOCAL_INFILE=1 \
-DWITH_MYISAM_STORAGE_ENGINE=1 \
-DWITH_INNOBASE_STORAGE_ENGINE=1

参数说明:
-DCMAKE_INSTALL_PREFIX=/usr/local/mysql //安装目录
-DMYSQL_DATADIR=/usr/local/mysql/data //数据库存放目录
-DWITH_MYISAM_STORAGE_ENGINE=1 //安装myisam存储引擎
-DWITH_INNOBASE_STORAGE_ENGINE=1 //安装innodb存储引擎
-DWITH_ARCHIVE_STORAGE_ENGINE=1 //安装archive存储引擎
-DWITH_BLACKHOLE_STORAGE_ENGINE=1 //安装blackhole存储引擎
-DENABLED_LOCAL_INFILE=1 //允许从本地导入数据
-DDEFAULT_CHARSET=utf8 　　//使用utf8字符
-DDEFAULT_COLLATION=utf8_general_ci //校验字符
-DEXTRA_CHARSETS=all 　　//安装所有扩展字符集
-DMYSQL_TCP_PORT=3306 //MySQL监听端口
-DMYSQL_USER=mysql //MySQL用户名
其他参数:
-DWITH-EMBEDDED_SERVER=1 //编译成embedded MySQL library (libmysqld.a)
-DSYSCONFDIR=/etc //MySQL配辑文件
-DMYSQL_UNIX_ADDR=/tmp/mysqld.sock //Unix socket 文件路径
-DWITH_READLINE=1 //快捷键功能
-DWITH_SSL=yes //SSL
-DWITH_MEMORY_STORAGE_ENGINE=1 //安装memory存储引擎
-DWITH_FEDERATED_STORAGE_ENGINE=1 //安装frderated存储引擎
-DWITH_PARTITION_STORAGE_ENGINE=1 //安装数据库分区
-DINSTALL_PLUGINDIR=/usr/local/mysql/plugin //插件文件及配置路径

make && make install

#mysql初始化

#添加mysql用户组
groupadd mysql

#创建mysql用户并归属于mysql组
useradd  -g mysql mysql

#复制数据库配置文件（my-medium.cnf表示数据量级为中等）
cp support-files/my-medium.cnf /etc/my.cnf
#复制启动文件
cp support-files/mysql.server /etc/init.d/mysqld

#递归的把当前文件改为mysql用户跟组，如果启动失败从这步重新开始
cd /usr/local/mysql
chown -R mysql.mysql .

#修改 mysql 的配置 my.cnf 
vi /etc/my.cnf
#在[mysqld]下面添加 
basedir = /usr/local/mysql
datadir = /usr/local/mysql/data
log-error = /usr/local/mysql/mysql_error.log
pid-file = /usr/local/mysql/data/mysql.pid
default-storage-engine=MyISAM
user = mysql

#创建mysql测试数据库和系统的数据库（正常的是生成5个文件）
/usr/local/mysql/scripts/mysql_install_db \
--user=mysql \
--basedir=/usr/local/mysql \
--datadir=/usr/local/mysql/data

#把当前目录文件的主人都改为root，避免数据库恢复为出厂设置。
chown -R root .
#启动mysql
bin/mysqld_safe --user=mysql &

#将 mysql 加入开机启动 
chmod +x /etc/init.d/mysqld
#编辑此文件，查找并修改以下变量内容：
vi /etc/init.d/mysqld
basedir=/usr/local/mysql
datadir=/usr/mysql/data

#增加系统服务
chkconfig --add mysqld 
#设置运行级别
chkconfig --level 345 mysqld on

#为MySQL配置环境变量，以后使用起来方便 
export PATH=/usr/local/mysql/bin:$PATH

#启动mysql服务
service mysqld start 

#查看mysql是否启动成功
ps -A | grep mysql

#设置密码 
mysql_secure_installation

#测试数据库
bin/mysql –u root -p
show databases;	




#php安装
wget http://cn2.php.net/distributions/php-5.4.33.tar.gz
tar -xzvf php-5.4.33.tar.gz
#安装依赖软件
#rpm -qa | grep freetype
yum -y install freetype freetype-devel
yum -y install gd gd-devel
yum -y install libxml2 libxml2-devel
yum -y install libjpeg libjpeg-devel
yum -y install libpng libpng-devel

./configure --prefix=/usr/local/php \
--with-apxs2=/usr/local/http2/bin/apxs \
--with-mysql=mysqlnd \
--with-pdo-mysql=mysqlnd \
--with-mysqli=mysqlnd \
--with-freetype-dir=/usr/local/freetype \
--with-gd=/usr/local/gd \
--with-zlib --with-libxml-dir=/usr/local/libxml2 \
--with-jpeg-dir=/usr/local/jpeg \
--with-png-dir \
--enable-mbstring=all \
--enable-mbregex \
--enable-shared 

#安装
make && make install

#复制配置文件
cp php.ini-development /usr/local/php/lib/php.ini

#配置apache
cp /usr/local/http2/conf/httpd.conf /usr/local/http2/conf/httpd2.conf.bak
vi /usr/local/http2/conf/httpd.conf

1)引入: "Include conf/extra/httpd-vhosts.conf"

2)增加: "AddType application/x-httpd-php .php"	

3)找到下面这段话:
<IfModule dir_module>
    DirectoryIndex index.html
</IfModule>
在index.html 前面添加index.php

4)修改根目录
DocumentRoot "/usr/local/http2/htdocs"
<Directory "/usr/local/http2/htdocs">

5)注释内部所有行 "extra/httpd-vhosts.conf"


4)建立php测试网页
vi /usr/local/apache2/htdocs/index.php	 
输入如下内容:
<?php
phpinfo();
?>

5)重启apache
shell> /usr/local/http2/bin/apachectl restart








